# Быстрая настройка проброса портов TURN сервера на Keenetic Lite

## Для работы видео на мобильных устройствах

### Шаг 1: Определите IP сервера

```bash
# На сервере выполните
ip addr show
# или
hostname -I
```

Найдите IP в локальной сети (например, `192.168.1.100`).

### Шаг 2: Войдите в веб-интерфейс Keenetic

1. Откройте браузер
2. Перейдите: `http://192.168.1.1`
3. Введите логин/пароль (по умолчанию: `admin`/`admin`)

### Шаг 3: Настройте проброс портов

Перейдите в **"Интернет" → "Виртуальные серверы"** и добавьте:

#### 1. TURN TCP (порт 3478):
- **Название:** `TURN TCP`
- **Внешний порт:** `3478`
- **Внутренний IP:** `192.168.1.100` (ваш IP сервера)
- **Внутренний порт:** `3478`
- **Протокол:** `TCP`
- **Включено:** ✓

#### 2. TURN UDP (порт 3478):
- **Название:** `TURN UDP`
- **Внешний порт:** `3478`
- **Внутренний IP:** `192.168.1.100`
- **Внутренний порт:** `3478`
- **Протокол:** `UDP`
- **Включено:** ✓

#### 3. Релейные порты (49152-65535):
- **Название:** `TURN Relay`
- **Внешний порт:** `49152-65535` (или `49152:65535`)
- **Внутренний IP:** `192.168.1.100`
- **Внутренний порт:** `49152-65535`
- **Протокол:** `UDP`
- **Включено:** ✓

**Примечание:** Если Keenetic не поддерживает диапазоны, пробросьте хотя бы порт 3478 (TCP и UDP).

### Шаг 4: Настройте файрвол на сервере

```bash
# Для UFW
sudo ufw allow 3478/tcp
sudo ufw allow 3478/udp
sudo ufw allow 49152:65535/udp
sudo ufw status
```

### Шаг 5: Проверьте работу TURN сервера

```bash
# На сервере
sudo systemctl status coturn

# Проверьте порты
sudo netstat -tulpn | grep 3478
```

### Шаг 6: Проверьте извне

Используйте онлайн-инструмент:
- https://canyouseeme.org/
- Введите порт `3478` и проверьте, открыт ли он

## Готово!

После настройки проброса портов видео должно работать на мобильных устройствах.

**Важно:** Убедитесь, что:
- ✅ TURN сервер установлен и запущен на сервере
- ✅ Порты 3478 (TCP/UDP) проброшены на роутере
- ✅ Файрвол на сервере разрешает подключения
- ✅ В `.env.local` фронтенда указан правильный `NEXT_PUBLIC_WEBRTC_TURN_SERVER`

Подробная инструкция: `KEENETIC_PORT_FORWARDING.md`

