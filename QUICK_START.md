# üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç - –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å

## ‚úÖ –®–ê–ì 1: –î–æ–±–∞–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ Socket.IO –≤ server.js

**–§–∞–π–ª:** `backend/server.js`

**–ù–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫—É:**
```javascript
const io = socketIo(server, {
  cors: {
    origin: process.env.CORS_ORIGIN?.split(',') || '*',
    methods: ['GET', 'POST'],
    credentials: true
  }
});
```

**–î–æ–±–∞–≤–∏—Ç—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –Ω–µ—ë:**
```javascript
// –î–µ–ª–∞–µ–º io –¥–æ—Å—Ç—É–ø–Ω—ã–º –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ (–¥–ª—è QR-–∫–æ–¥–∞ –∏ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤)
app.set('io', io);
```

**‚úÖ –≠—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!**

---

## ‚úÖ –®–ê–ì 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±—ç–∫–µ–Ω–¥

### –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ PM2 (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ):
```bash
cd /ssd/www/bigo-mvp/backend
pm2 restart bigo-backend
```

### –ï—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ:
```bash
cd backend
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å (Ctrl+C)
npm run dev
```

---

## ‚úÖ –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É

### 3.1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API QR-–∫–æ–¥–∞:

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```bash
curl -X POST http://api.bigo.1tlt.ru/api/auth/qr-session
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "sessionId": "abc123...",
  "qrData": "data:image/png;base64,iVBORw0KG...",
  "expiresIn": 300
}
```

### 3.2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (Vercel –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `/login`
3. –î–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è:
   - ‚úÖ QR-–∫–æ–¥ –¥–ª—è –≤—Ö–æ–¥–∞
   - ‚úÖ –ö–Ω–æ–ø–∫–∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π (Facebook, Google, VK, Twitter)
   - ‚úÖ –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞
   - ‚úÖ –°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é

### 3.3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±–æ–π –∞–∫—Ç–∏–≤–Ω—ã–π —Å—Ç—Ä–∏–º
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã:
   - ‚úÖ –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —Å –ø—Ä–æ—Ñ–∏–ª–µ–º —Å—Ç—Ä–∏–º–µ—Ä–∞
   - ‚úÖ –ö–Ω–æ–ø–∫–∏ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" –∏ "–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è"
   - ‚úÖ –í–∏–¥–µ–æ–ø–ª–µ–µ—Ä
   - ‚úÖ –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å —Å —á–∞—Ç–æ–º
   - ‚úÖ –ë–∞–Ω–Ω–µ—Ä —Å —Ä–µ–∫–ª–∞–º–æ–π

---

## ‚úÖ –®–ê–ì 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
pm2 logs bigo-backend --lines 50
```

### –ò—â–∏—Ç–µ –æ—à–∏–±–∫–∏:
- ‚ùå "Cannot find module '../controllers/qrController'" - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å
- ‚ùå "io is not defined" - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–æ–±–∞–≤–∏–ª–∏ `app.set('io', io)`
- ‚ùå CORS –æ—à–∏–±–∫–∏ - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `CORS_ORIGIN` –≤ `.env`

---

## üìù –ß—Ç–æ —É–∂–µ –≥–æ—Ç–æ–≤–æ:

‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç QRCodeLogin —Å–æ–∑–¥–∞–Ω  
‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä qrController.js —Å–æ–∑–¥–∞–Ω  
‚úÖ –ú–∞—Ä—à—Ä—É—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ auth.js  
‚úÖ –ü–∞–∫–µ—Ç qrcode —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω  
‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü—ã –ª–æ–≥–∏–Ω–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã  
‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∞  
‚úÖ `app.set('io', io)` –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ server.js  

---

## üéØ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å:

1. **QR-–∫–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ä–∞–∑—É
2. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞** - –Ω–æ–≤—ã–π –¥–∏–∑–∞–π–Ω
3. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏** - –Ω–æ–≤—ã–π –¥–∏–∑–∞–π–Ω
4. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏** - —Å—Ç–∏–ª—å Bigo Live
5. **API endpoints** - `/api/auth/qr-session`, `/api/auth/qr-confirm`

---

## ‚ö†Ô∏è –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

1. **OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã** - –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö –∏ –¥–æ–±–∞–≤–∏—Ç—å credentials
2. **–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** - –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è QR-–∫–æ–¥–∞
3. **Redis** - –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è QR-—Å–µ—Å—Å–∏–π (—Å–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è in-memory)

---

## üîç –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –±—ç–∫–µ–Ω–¥ –∑–∞–ø—É—â–µ–Ω
curl http://api.bigo.1tlt.ru/api/health

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å QR-–∫–æ–¥ API
curl -X POST http://api.bigo.1tlt.ru/api/auth/qr-session

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
pm2 logs bigo-backend --lines 20
```

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö —à–∞–≥–æ–≤ –≤—Å–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å. –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –ø—Ä–æ–±–ª–µ–º—ã - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã.

